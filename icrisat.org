#+PROPERTY: header-args:python :results output raw  :noweb no-export :exports code

* Introduction
  Here we'll explore actual consumption decisions made by some very
  poor households drawn from a set of villages in South India studied
  by the International Crops Research Institute for the Semi-Arid
  Tropics (ICRISAT) starting in the mid-seventies, and continuing
  (irregularly) up to 2004.  Data are drawn from a sample of
  households in each of six different villages.

* Consumption Expenditures from Schedule L
   We can collect detailed consumption expenditure items by examining
   Schedule L, with its system of double-accounting.  Here the account
   code for food is 71 ("including milk, sweets and spices"), and the
   account code for "Narcotics, tea, coffee, tobacco, pan, alcoholic
   beverages" is 72.  Other sorts of expenditures related to
   consumption are in accounts 71--79, as follows:

| Consumption Category                                                                                                                           | Acct |
|------------------------------------------------------------------------------------------------------------------------------------------------+------|
| Food (codes) including milk, sweets and spices                                                                                                 |   71 |
| Narcotics, tea, coffee, tobacco, pan, alcoholic beverages                                                                                      |   72 |
| Clothing, sewing of cloth, other tailoring expenses, thread, needles, chappals and other footwear (purchase and repair), etc., (no item codes) |   73 |
| Medicines, cosmetics, soap, barber service (no item codes)                                                                                     |   74 |
| Travel and entertainment, (no item codes)                                                                                                      |   75 |
| Electricity, water charges and cooking fuels (like kerosene, match box) for household use, (no item codes)                                     |   76 |
| Labor expenses for domestic work, (no item codes)                                                                                              |   77 |
| Ceremonial expenses (including Kapur, Gulal, Agarbathi, etc.)                                                                                  |   78 |
| Edible oils and fats (other than ghee) (no item code)                                                                                          |   79 |
| Others, including complete meals in hotel, school and educational materials, stamps, stationery, grinding and milling charges etc.             |   70 |

Different kinds of food and narcotics are coded according to
[[food_codes]], along with account codes for those accounts that have no
item codes.
   
   #+name: food_codes
   | Food                                                          | Code |
   |---------------------------------------------------------------+------|
   | Bajra/Pearl millet (Local variety)                            | CA   |
   | Bajra/Pearl millet (HYV)                                      | CB   |
   | Jowar/Sorghum (Local variety)                                 | CC   |
   | Jowar/Sorghum (HYV)                                           | CD   |
   | Maize (Local variety)                                         | CE   |
   | Maize (HYV)                                                   | CF   |
   | Ragi/Finger millet                                            | CG   |
   | Other minor millets                                           | CH   |
   | Paddy (Local variety)                                         | CJ   |
   | Paddy (HYV)                                                   | CK   |
   | Wheat (Local variety)                                         | CL   |
   | Wheat (HYV)                                                   | CM   |
   | Rice (local variety)                                          | CN   |
   | Rice (HYV variety)                                            | CP   |
   | Meals                                                         | CQ   |
   | Other cereals                                                 | CX   |
   | Redgram (Tur)/Pigeonpea                                       | PA   |
   | Greengram (Mung)                                              | PB   |
   | Blackgram (Urad)                                              | PC   |
   | Bengalgram (Chenna)/Chickpea                                  | PD   |
   | Redgram dhal                                                  | PF   |
   | Greengram dhal                                                | PG   |
   | Blackgram dhal                                                | PH   |
   | Bengalgram dhal                                               | PJ   |
   | Guar                                                          | PK   |
   | Cowpea                                                        | PL   |
   | Soybean                                                       | PN   |
   | Other pulses                                                  | PX   |
   | Other dhal                                                    | PZ   |
   | Groundnuts                                                    | BA   |
   | Sesamum                                                       | BB   |
   | Castor                                                        | BC   |
   | Mustard                                                       | BD   |
   | Linseed                                                       | BE   |
   | Linseed Oil                                                   | BL   |
   | Castor (HYV)                                                  | BM   |
   | Sunflower                                                     | BF   |
   | Safflower                                                     | BG   |
   | Safflower oil                                                 | BS   |
   | Groundnut oil                                                 | BH   |
   | Other oilseeds                                                | BX   |
   | Cotton (Local variety)                                        | DA   |
   | Cotton (HYV)                                                  | DB   |
   | Other Fiber crops                                             | DX   |
   | Sugarcane                                                     | SA   |
   | Sugar                                                         | SB   |
   | Gur (jaggery)                                                 | ZG   |
   | Other sugar products                                          | SX   |
   | Onion                                                         | VA   |
   | Chillies                                                      | VB   |
   | Brinjal                                                       | VC   |
   | Cabbage                                                       | VD   |
   | Tomato                                                        | VE   |
   | Cauliflower                                                   | VF   |
   | Leafy vegetables                                              | VL   |
   | Potato                                                        | VP   |
   | Carrot and Radish                                             | VR   |
   | Fennel                                                        | VS   |
   | Tubers                                                        | VT   |
   | Other vegetables                                              | VX   |
   | Other spices                                                  | VY   |
   | Grapes                                                        | FA   |
   | Lemon                                                         | FB   |
   | Orange                                                        | FC   |
   | Mango                                                         | FD   |
   | Coconut                                                       | FE   |
   | Toddy Trees                                                   | FG   |
   | Other Fruits                                                  | FX   |
   | Banana                                                        | FH   |
   | Papaya                                                        | FP   |
   | Alcoholic beverages                                           | NA   |
   | Coffee                                                        | NC   |
   | Tea                                                           | NT   |
   | Tobacco, beedi                                                | NN   |
   | Pan, betel, etc.                                              | NP   |
   | Others (Ganja, etc.)                                          | NZ   |
   | Milk                                                          | AM   |
   | Ghee                                                          | AG   |
   | Other milk products like curd, etc.                           | AP   |
   | Dung cakes                                                    | AC   |
   | Dung, manure                                                  | AD   |
   | Skin, hide, bones                                             | AS   |
   | Wool, goat hair, etc.                                         | AW   |
   | Eggs                                                          | AY   |
   | Other animal products                                         | AX   |
   | Fish                                                          | AF   |
   | Bullocks                                                      | LA   |
   | Cow                                                           | LB   |
   | Young Cattle (under 3 years)                                  | LC   |
   | He buffalo                                                    | LD   |
   | She buffalo                                                   | LE   |
   | Young buffalo (under 3 years)                                 | LF   |
   | Horse                                                         | LG   |
   | Donkey                                                        | LH   |
   | Goat                                                          | LK   |
   | Sheep                                                         | LM   |
   | Pig                                                           | LP   |
   | Poultry birds                                                 | LQ   |
   | Other livestock                                               | LZ   |
   | Medicine Doctor's fees                                        | NM   |
   | Cosmetics tooth paste etc.                                    | NB   |
   | Soap, washing powder                                          | NS   |
   | Barber service (and material relating to it)                  | ND   |
   | Other personal                                                | NZ   |
   | Complete meals in hotel                                       | GM   |
   | Educational expenses (fees)                                   | GS   |
   | Educational material expenses (pen, books, paper, etc.)       | GE   |
   | Grinding/milling charges                                      | GG   |
   | Processed foods (e.g. biscuits Khara, syrup, baby food, etc.) | GP   |
   | Other consumption                                             | GZ   |
   | Other Food                                                    | 71   |
   | Other Narcotics                                               | 72   |
   | Clothing                                                      | 73   |
   | Other Clothing                                                | QK   |
   | Medicine, cosmetics, etc.                                     | 74   |
   | Travel & Entertainment                                        | 75   |
   | Utilities                                                     | 76   |
   | Domestic labor                                                | 77   |
   | Ceremonial expenses                                           | 78   |
   | Edible oils                                                   | 79   |
   | Other                                                         | 70   |

** Column Specifications for Schedule L
#+begin_src python :tangle l.py
import pandas as pd
from collections import OrderedDict

Ldict =[('village', (2,3),  str),
        ('landclas',(3,4),  int),
        ('hhno',    (4,6),  int),
        ('year',    (6,7),  int),
        ('dayofint',(7,10), int),
        ('accrec',  (10,12),int),
        ('itmcode1',(12,14),str),
        ('itmcode2',(14,15),str),
        ('unit1',   (15,16),str),
        ('gdsoutq', (16,22),int),
        ('monvain', (22,28),float),
        ('accpay',  (29,31),int),
        ('itmcode3',(31,33),str),
        ('itmcode4',(33,34),str),
        ('unit2',   (34,35),str),
        ('gdsinq',  (35,41),int),
        ('monvaout',(41,48),float),
        ('distance',(48,50),float),
        ('partner', (50,51),str),
        ('kincast', (51,53),str),
        ('etc',     (53,57),str)]

Ldict = OrderedDict(sorted([(s[0],((s[1][0]-1,s[1][1]-1),s[2])) for s in Ldict], key = lambda t: t[1][0][0]))
Lcols = OrderedDict(sorted([(s[0],s[1][0]) for s in Ldict.items()], key = lambda t: t[1][0]))
Ltypes = {k:v[1] for k,v in Ldict.items()}


L = [pd.read_fwf('~/Data/VLS/MyVLS/VLS1/L/%s' % v,list(Lcols.values()),dtype=Ltypes) for v in ['aur','shi','kan']]

L[0].columns = list(Ldict.keys())
L[1].columns = list(Ldict.keys())
L[2].columns = list(Ldict.keys())

L = pd.concat(L)

# Clean up some garbage in accpay column
L.accpay = pd.to_numeric(L.accpay,errors='coerce')

# Deal with  a few lowercase codes
L.itmcode3 = L.itmcode3.str.upper()

# Create unique household ID
L['HHID'] = ['%s%d' % l for l in zip(L.village,L.hhno.fillna(0))]

L.to_pickle('l.df')

#+end_src

** Expenditures and Quantities
#+begin_src python :var codes=food_codes :tangle expenditures.py
import numpy as np
import pandas as pd
from cfe.df_utils import orgtbl_to_df

L = pd.read_pickle('l.df')

d = {v[1]:v[0] for v in codes}

Consumption = L.query('70 <= accpay < 80')[['village','HHID','year','accpay','itmcode3','unit2','gdsinq','monvaout']]

# Replace Nans in itmcode3 with accpay number
Consumption.itmcode3.fillna(Consumption.accpay,inplace=True)
del Consumption['accpay']

# Clean up some non-numeric garbage
Consumption.monvaout = Consumption.monvaout.astype(float)

# Similarly for quantities
Consumption.gdsinq = Consumption.gdsinq.astype(float)

X = Consumption.groupby(['village','year','HHID','itmcode3'])['monvaout'].sum()

Q = Consumption.groupby(['village','year','HHID','itmcode3','unit2'])['gdsinq'].sum()

Units = {'Q':'Quintal',
         'L':'Kilograms', # On theory of fluid weight being roughly 1kg/l
         'l':'Kilograms',
         'C':'Hundreds',
         'T':'Cubic feet',
         'M':'Meters',
         'K':'Kilograms',
         'k':'Kilograms',
         'N':'Number',
         'A':'Acres',
         'H':'Hours',
         'S':'Square feet'}

# Fix year indicators
X.rename({0.:80,1:81,2:82,3:83,4:84,5:75,6:76,7:77,8:78,9:79},level='year',inplace=True)
Q.rename({0.:80,1:81,2:82,3:83,4:84,5:75,6:76,7:77,8:78,9:79},level='year',inplace=True)

X = X.unstack('itmcode3').rename(columns=d)
X.index = X.index.reorder_levels(['HHID','year','village'])
X.index.names = ['j','t','m']

X.to_pickle('x.df')

Q = Q.unstack('itmcode3').rename(columns=d)

y = np.log(X)

#y.index.names = ['m','t','j']
#y = y.reorder_levels(['j','t','m'])

y.to_pickle('y.df')

Q.index.names = ['m','t','j','unit']
Q.rename(index=Units,level='unit',inplace=True)
Q = Q.reorder_levels(['j','t','m','unit'])
Q = Q.fillna(0)

Q.to_pickle('q.df')
#+end_src

#+results:

* Food Conversion (to nutrients)
  Alessandro Tarozzi provides a mapping from foods reported in the
  68th round of the NSS data into nutritional outcomes, using
  nutritive values from cite:gopalan-etal80.  Identifying foods
  consumed in the ICRISAT data which correspond to foods in the NSS
  data is mostly straight-forward.
** ICRISAT Foods to NSS 68 Food Codes
#+name: icrisat2nss
| ICRISAT Food Label                    | Code |
|---------------------------------------+------|
| Edible oils                           |  185 |
| Fish                                  |  191 |
| Ghee                                  |  164 |
| Milk                                  |  160 |
| "Other milk products like curd, etc." |  163 |
| Eggs                                  |  190 |
| Groundnuts                            |  241 |
| Sesamum                               |  260 |
| Mustard                               |  181 |
| Linseed                               |  185 |
| Sunflower                             |  184 |
| Safflower                             |  184 |
| Groundnut oil                         |  182 |
| Linseed Oil                           |  185 |
| Safflower oil                         |  184 |
| Other oilseeds                        |  260 |
| Bajra/Pearl millet (Local variety)    |  116 |
| Bajra/Pearl millet (HYV)              |  116 |
| Jowar/Sorghum (Local variety)         |  115 |
| Jowar/Sorghum (HYV)                   |  115 |
| Maize (Local variety)                 |  117 |
| Maize (HYV)                           |  117 |
| Ragi/Finger millet                    |  121 |
| Other minor millets                   |  120 |
| Paddy (Local variety)                 |  102 |
| Paddy (HYV)                           |  102 |
| Wheat (Local variety)                 |  108 |
| Wheat (HYV)                           |  108 |
| Rice (local variety)                  |  102 |
| Rice (HYV variety)                    |  102 |
| Meals                                 |  280 |
| Other cereals                         |  122 |
| Grapes                                |  237 |
| Lemon                                 |  216 |
| Orange                                |  228 |
| Mango                                 |  231 |
| Coconut                               |  224 |
| Banana                                |  220 |
| Other Fruits                          |  238 |
| Complete meals in hotel               |  280 |
| Various processed foods               |  296 |
| Bullocks                              |  193 |
| Cow                                   |  193 |
| Young Cattle (under 3 years)          |  193 |
| He buffalo                            |  193 |
| She buffalo                           |  193 |
| Goat                                  |  192 |
| Sheep                                 |  192 |
| Pig                                   |  194 |
| Poultry birds                         |  195 |
| Coffee                                |  272 |
| "Pan, betel, etc."                    |  301 |
| Tea                                   |  271 |
| Redgram (Tur)/Pigeonpea               |  142 |
| Greengram (Mung)                      |  143 |
| Blackgram (Urad)                      |  142 |
| Bengalgram (Chenna)/Chickpea          |  142 |
| Redgram dhal                          |  142 |
| Greengram dhal                        |  143 |
| Blackgram dhal                        |  142 |
| Bengalgram dhal                       |  142 |
| Cowpea                                |  146 |
| Soybean                               |  148 |
| Other pulses                          |  148 |
| Other dhal                            |  148 |
| Sugarcane                             |  172 |
| Sugar                                 |  172 |
| Other sugar products                  |  172 |
| Onion                                 |  201 |
| Chillies                              |  207 |
| Brinjal                               |  203 |
| Cabbage                               |  212 |
| Tomato                                |  202 |
| Leafy vegetables                      |  206 |
| Potato                                |  200 |
| Fennel                                |  261 |
| Other vegetables                      |  217 |
| Other spices                          |  261 |
| Gur (jaggery)                         |  173 |

** NSS 68 Food Codes
#+name: nss68codes
| NSS68 Items                                        | Code |
|----------------------------------------------------+------|
| apple                                              |  236 |
| arhar, tur                                         |  140 |
| baby food                                          |  161 |
| bajra & products                                   |  116 |
| banana                                             |  220 |
| barley & products                                  |  118 |
| beef/ buffalo meat                                 |  193 |
| beer                                               |  323 |
| berries                                            |  234 |
| besan                                              |  151 |
| biscuits, chocolates (rural)                       |  291 |
| biscuits, chocolates (urban)                       |  291 |
| black pepper                                       |  255 |
| bread (bakery)                                     |  113 |
| brinjal                                            |  203 |
| butter                                             |  165 |
| cabbage                                            |  212 |
| cake, pastry, prepared sweets (rural)              |  290 |
| cake, pastry, prepared sweets (urban)              |  290 |
| candy, misri                                       |  174 |
| carrot                                             |  205 |
| cashewnut                                          |  243 |
| cauliflower                                        |  211 |
| cereal substitutes (tapioca, jackfruit seed, etc.) |  139 |
| chicken                                            |  195 |
| chillis: green                                     |  207 |
| chips                                              |  293 |
| chira                                              |  103 |
| coconut                                            |  224 |
| coconut oil                                        |  183 |
| coconut, copra                                     |  240 |
| coconut: green                                     |  225 |
| coffee : cups                                      |  272 |
| coffee: powder                                     |  273 |
| cold beverages: bottled/canned                     |  275 |
| cooked meals purchased                             |  280 |
| cooked meals received as assistance                |  281 |
| cooked meals received free in workplace            |  282 |
| cooked snacks purchased [samosa, puri, paratha,    |  283 |
| cooked snacks purchased [samosa, puri, paratha,    |  283 |
| country liquor                                     |  322 |
| curd                                               |  163 |
| curry powder                                       |  258 |
| dates                                              |  242 |
| dhania                                             |  253 |
| dry chillies                                       |  256 |
| edible oil: others                                 |  185 |
| eggs                                               |  190 |
| fish, prawn                                        |  191 |
| foreign/ refined liquor or wine                    |  324 |
| french beans, barbati                              |  215 |
| fruit juice and shake                              |  276 |
| garlic                                             |  251 |
| ghee                                               |  164 |
| ginger                                             |  250 |
| goat meat/mutton                                   |  192 |
| gourd, pumpkin                                     |  213 |
| gram (split)                                       |  141 |
| gram (whole)                                       |  142 |
| gram products                                      |  150 |
| grapes                                             |  237 |
| groundnut                                          |  241 |
| groundnut oil                                      |  182 |
| guava                                              |  226 |
| gur                                                |  173 |
| honey                                              |  175 |
| ice-cream (rural)                                  |  166 |
| ice-cream (urban)                                  |  166 |
| ingredients for pan                                |  302 |
| jackfruit                                          |  221 |
| jeera                                              |  252 |
| jowar & products                                   |  115 |
| kharbooza                                          |  232 |
| khesari                                            |  147 |
| khoi, lawa                                         |  104 |
| lady?s finger                                      |  208 |
| leechi                                             |  235 |
| lemon                                              |  216 |
| maida                                              |  110 |
| maize & products                                   |  117 |
| mango                                              |  231 |
| masur                                              |  144 |
| milk : condensed/ powder                           |  162 |
| milk: liquid                                       |  160 |
| moong                                              |  143 |
| muri                                               |  105 |
| mustard oil                                        |  181 |
| oilseeds                                           |  260 |
| onion                                              |  201 |
| orange, mausami                                    |  228 |
| other beverages: cocoa, chocolate etc. (rural)     |  277 |
| other beverages: cocoa, etc. (urban)               |  278 |
| other cereals                                      |  122 |
| other dry fruits                                   |  247 |
| other fresh fruits (rural)                         |  238 |
| other fresh fruits (urban)                         |  238 |
| other milk products (rural)                        |  167 |
| other milk products (urban)                        |  167 |
| other nuts                                         |  245 |
| other packaged processed food (rural)              |  296 |
| other packaged processed food (urban)              |  296 |
| other pulse products                               |  152 |
| other pulses                                       |  148 |
| other rice products                                |  106 |
| other served processed food (rural)                |  284 |
| other served processed food (urban)                |  284 |
| other spices                                       |  261 |
| other vegetables (rural)                           |  217 |
| other vegetables (urban)                           |  217 |
| other wheat products                               |  114 |
| others: birds, crab, oyster, tortoise etc.         |  196 |
| palak/other leafy vegetables                       |  206 |
| pan: finished                                      |  301 |
| pan: leaf                                          |  300 |
| papad, bhujia, namkeen, mixture, chanachur         |  292 |
| papad, bhujia, namkeen, mixture, chanachur         |  292 |
| papaya                                             |  230 |
| parwal, patal/kundru                               |  210 |
| pears, naspati                                     |  233 |
| peas                                               |  146 |
| peas                                               |  214 |
| pickles                                            |  294 |
| pineapple                                          |  223 |
| pork                                               |  194 |
| potato (includes sweet potato and green plantain)  |  200 |
| radish                                             |  204 |
| ragi & products                                    |  121 |
| raisin, kishmish, monacca, etc.                    |  246 |
| refined oil [sunflower, soyabean, saffola, etc.]   |  184 |
| rice  PDS                                      |  101 |
| rice  other sources                            |  102 |
| sauce, jam, jelly                                  |  295 |
| sewai, noodles                                     |  112 |
| singara                                            |  227 |
| small millets & products                           |  120 |
| sugar  PDS                                     |  171 |
| sugar  other sources                           |  172 |
| suji, rawa                                         |  111 |
| tamarind                                           |  257 |
| tea : cups                                         |  270 |
| tea : leaf                                         |  271 |
| toddy                                              |  321 |
| tomato                                             |  202 |
| turmeric                                           |  254 |
| urd                                                |  145 |
| vanaspati, margarine                               |  180 |
| walnut                                             |  244 |
| watermelon                                         |  222 |
| wheat/atta  PDS                                |  107 |
| wheat/atta  other sources                      |  108 |

** ICRISAT Food Conversion Tables

   Combining the mapping from ICRISAT foods to NSS 68 codes, one can
   then calculate nutritional content for ICRISAT foods.
#+begin_src python :var foodcodes = icrisat2nss :colnames no :tangle fooditems.py
from cfe.df_utils import orgtbl_to_df, df_to_orgtbl
import pandas as pd

foodcodes = orgtbl_to_df(foodcodes).set_index('Code')

nss68 = pd.read_stata('~/Data/NSS/OriginalData/Food2Nutrition/nss68list.dta').set_index('id_item_68')
nss68.index.name = "Code"
nss68.rename(columns={'item':'NSS Item'},inplace=True)

Units = {'kg':'Kilograms',
         'gm':'Grams',
         'no.':'Number',
         'Re':'Rupees',
         'litre':'Kilograms'}

nss68['unit'].replace(Units,inplace=True)

nutrients = ['protein', 'fat', 'fibre', 'carbohydrate', 'energy_kcal', 'energy_kj',
             'calcium', 'iron', 'betacarotene', 'caroten_total', 'thiamine',
             'riboflavin', 'niacin', 'ascorbic_total', 'ext_source', 'pu_cal',
             'pu_prot', 'pu_fat']

fooditems = nss68[['NSS Item']].join(foodcodes,how='right')
print(df_to_orgtbl(fooditems.reset_index(),float_fmt='%d'))

fct = foodcodes.join(nss68) # ICRISAT food conversion table
fct.loc[fct.unit=='Grams',nutrients] = fct.loc[fct.unit=='Grams',nutrients]*1000
fct.loc[fct.unit=='Grams','unit'] = 'Kilograms'

fct.loc[fct.unit=='Hundreds',nutrients] = fct.loc[fct.unit=='Hundreds',nutrients]*100
fct.loc[fct.unit=='Hundreds','unit'] = 'Number'

fct = fct.reset_index().set_index(['ICRISAT Food Label','unit'])

fct=fct[~fct.index.duplicated()][nutrients]
fct.to_pickle('fct_units.df')

fct = fct.fillna(0)

fct.to_pickle('fct.df')
#+end_src

#+results:
|    | Code | NSS Item                                          | ICRISAT Food Label                  |
|----+------+---------------------------------------------------+-------------------------------------|
|  0 |  102 | rice  other sources                           | Paddy (Local variety)               |
|  1 |  102 | rice  other sources                           | Paddy (HYV)                         |
|  2 |  102 | rice  other sources                           | Rice (local variety)                |
|  3 |  102 | rice  other sources                           | Rice (HYV variety)                  |
|  4 |  108 | wheat/atta  other sources                     | Wheat (Local variety)               |
|  5 |  108 | wheat/atta  other sources                     | Wheat (HYV)                         |
|  6 |  115 | jowar & products                                  | Jowar/Sorghum (Local variety)       |
|  7 |  115 | jowar & products                                  | Jowar/Sorghum (HYV)                 |
|  8 |  116 | bajra & products                                  | Bajra/Pearl millet (Local variety)  |
|  9 |  116 | bajra & products                                  | Bajra/Pearl millet (HYV)            |
| 10 |  117 | maize & products                                  | Maize (Local variety)               |
| 11 |  117 | maize & products                                  | Maize (HYV)                         |
| 12 |  120 | small millets & products                          | Other minor millets                 |
| 13 |  121 | ragi & products                                   | Ragi/Finger millet                  |
| 14 |  122 | other cereals                                     | Other cereals                       |
| 15 |  142 | gram (whole)                                      | Redgram (Tur)/Pigeonpea             |
| 16 |  142 | gram (whole)                                      | Blackgram (Urad)                    |
| 17 |  142 | gram (whole)                                      | Bengalgram (Chenna)/Chickpea        |
| 18 |  142 | gram (whole)                                      | Redgram dhal                        |
| 19 |  142 | gram (whole)                                      | Blackgram dhal                      |
| 20 |  142 | gram (whole)                                      | Bengalgram dhal                     |
| 21 |  143 | moong                                             | Greengram (Mung)                    |
| 22 |  143 | moong                                             | Greengram dhal                      |
| 23 |  146 | peas                                              | Cowpea                              |
| 24 |  148 | other pulses                                      | Soybean                             |
| 25 |  148 | other pulses                                      | Other pulses                        |
| 26 |  148 | other pulses                                      | Other dhal                          |
| 27 |  160 | milk: liquid                                      | Milk                                |
| 28 |  163 | curd                                              | Other milk products like curd, etc. |
| 29 |  164 | ghee                                              | Ghee                                |
| 30 |  172 | sugar  other sources                          | Sugarcane                           |
| 31 |  172 | sugar  other sources                          | Sugar                               |
| 32 |  172 | sugar  other sources                          | Other sugar products                |
| 33 |  173 | gur                                               | Gur (jaggery)                       |
| 34 |  181 | mustard oil                                       | Mustard                             |
| 35 |  182 | groundnut oil                                     | Groundnut oil                       |
| 36 |  184 | refined oil [sunflower, soyabean, saffola, etc.]  | Sunflower                           |
| 37 |  184 | refined oil [sunflower, soyabean, saffola, etc.]  | Safflower                           |
| 38 |  184 | refined oil [sunflower, soyabean, saffola, etc.]  | Safflower oil                       |
| 39 |  185 | edible oil: others                                | Edible oils                         |
| 40 |  185 | edible oil: others                                | Linseed                             |
| 41 |  185 | edible oil: others                                | Linseed Oil                         |
| 42 |  190 | eggs                                              | Eggs                                |
| 43 |  191 | fish, prawn                                       | Fish                                |
| 44 |  192 | goat meat/mutton                                  | Goat                                |
| 45 |  192 | goat meat/mutton                                  | Sheep                               |
| 46 |  193 | beef/ buffalo meat                                | Bullocks                            |
| 47 |  193 | beef/ buffalo meat                                | Cow                                 |
| 48 |  193 | beef/ buffalo meat                                | Young Cattle (under 3 years)        |
| 49 |  193 | beef/ buffalo meat                                | He buffalo                          |
| 50 |  193 | beef/ buffalo meat                                | She buffalo                         |
| 51 |  194 | pork                                              | Pig                                 |
| 52 |  195 | chicken                                           | Poultry birds                       |
| 53 |  200 | potato (includes sweet potato and green plantain) | Potato                              |
| 54 |  201 | onion                                             | Onion                               |
| 55 |  202 | tomato                                            | Tomato                              |
| 56 |  203 | brinjal                                           | Brinjal                             |
| 57 |  206 | palak/other leafy vegetables                      | Leafy vegetables                    |
| 58 |  207 | chillis: green                                    | Chillies                            |
| 59 |  212 | cabbage                                           | Cabbage                             |
| 60 |  216 | lemon                                             | Lemon                               |
| 61 |  217 | other vegetables (rural)                          | Other vegetables                    |
| 62 |  217 | other vegetables (urban)                          | Other vegetables                    |
| 63 |  220 | banana                                            | Banana                              |
| 64 |  224 | coconut                                           | Coconut                             |
| 65 |  228 | orange, mausami                                   | Orange                              |
| 66 |  231 | mango                                             | Mango                               |
| 67 |  237 | grapes                                            | Grapes                              |
| 68 |  238 | other fresh fruits (rural)                        | Other Fruits                        |
| 69 |  238 | other fresh fruits (urban)                        | Other Fruits                        |
| 70 |  241 | groundnut                                         | Groundnuts                          |
| 71 |  260 | oilseeds                                          | Sesamum                             |
| 72 |  260 | oilseeds                                          | Other oilseeds                      |
| 73 |  261 | other spices                                      | Fennel                              |
| 74 |  261 | other spices                                      | Other spices                        |
| 75 |  271 | tea : leaf                                        | Tea                                 |
| 76 |  272 | coffee : cups                                     | Coffee                              |
| 77 |  280 | cooked meals purchased                            | Meals                               |
| 78 |  280 | cooked meals purchased                            | Complete meals in hotel             |
| 79 |  296 | other packaged processed food (rural)             | Various processed foods             |
| 80 |  296 | other packaged processed food (urban)             | Various processed foods             |
| 81 |  301 | pan: finished                                     | Pan, betel, etc.                    |







#+name: tab:nss_and_icrisat_foods
|    | Code | NSS Item                                          | ICRISAT Food Label                  |
|----+------+---------------------------------------------------+-------------------------------------|
|  0 |  102 | rice  other sources                           | Paddy (Local variety)               |
|  1 |  102 | rice  other sources                           | Paddy (HYV)                         |
|  2 |  102 | rice  other sources                           | Rice (local variety)                |
|  3 |  102 | rice  other sources                           | Rice (HYV variety)                  |
|  4 |  108 | wheat/atta  other sources                     | Wheat (Local variety)               |
|  5 |  108 | wheat/atta  other sources                     | Wheat (HYV)                         |
|  6 |  115 | jowar & products                                  | Jowar/Sorghum (Local variety)       |
|  7 |  115 | jowar & products                                  | Jowar/Sorghum (HYV)                 |
|  8 |  116 | bajra & products                                  | Bajra/Pearl millet (Local variety)  |
|  9 |  116 | bajra & products                                  | Bajra/Pearl millet (HYV)            |
| 10 |  117 | maize & products                                  | Maize (Local variety)               |
| 11 |  117 | maize & products                                  | Maize (HYV)                         |
| 12 |  120 | small millets & products                          | Other minor millets                 |
| 13 |  121 | ragi & products                                   | Ragi/Finger millet                  |
| 14 |  122 | other cereals                                     | Other cereals                       |
| 15 |  142 | gram (whole)                                      | Redgram (Tur)/Pigeonpea             |
| 16 |  142 | gram (whole)                                      | Blackgram (Urad)                    |
| 17 |  142 | gram (whole)                                      | Bengalgram (Chenna)/Chickpea        |
| 18 |  142 | gram (whole)                                      | Redgram dhal                        |
| 19 |  142 | gram (whole)                                      | Blackgram dhal                      |
| 20 |  142 | gram (whole)                                      | Bengalgram dhal                     |
| 21 |  143 | moong                                             | Greengram (Mung)                    |
| 22 |  143 | moong                                             | Greengram dhal                      |
| 23 |  146 | peas                                              | Cowpea                              |
| 24 |  148 | other pulses                                      | Soybean                             |
| 25 |  148 | other pulses                                      | Other pulses                        |
| 26 |  148 | other pulses                                      | Other dhal                          |
| 27 |  160 | milk: liquid                                      | Milk                                |
| 28 |  163 | curd                                              | Other milk products like curd, etc. |
| 29 |  164 | ghee                                              | Ghee                                |
| 30 |  172 | sugar  other sources                          | Sugarcane                           |
| 31 |  172 | sugar  other sources                          | Sugar                               |
| 32 |  172 | sugar  other sources                          | Other sugar products                |
| 33 |  173 | gur                                               | Gur (jaggery)                       |
| 34 |  181 | mustard oil                                       | Mustard                             |
| 35 |  182 | groundnut oil                                     | Groundnut oil                       |
| 36 |  184 | refined oil [sunflower, soyabean, saffola, etc.]  | Sunflower                           |
| 37 |  184 | refined oil [sunflower, soyabean, saffola, etc.]  | Safflower                           |
| 38 |  184 | refined oil [sunflower, soyabean, saffola, etc.]  | Safflower oil                       |
| 39 |  185 | edible oil: others                                | Edible oils                         |
| 40 |  185 | edible oil: others                                | Linseed                             |
| 41 |  185 | edible oil: others                                | Linseed Oil                         |
| 42 |  190 | eggs                                              | Eggs                                |
| 43 |  191 | fish, prawn                                       | Fish                                |
| 44 |  192 | goat meat/mutton                                  | Goat                                |
| 45 |  192 | goat meat/mutton                                  | Sheep                               |
| 46 |  193 | beef/ buffalo meat                                | Bullocks                            |
| 47 |  193 | beef/ buffalo meat                                | Cow                                 |
| 48 |  193 | beef/ buffalo meat                                | Young Cattle (under 3 years)        |
| 49 |  193 | beef/ buffalo meat                                | He buffalo                          |
| 50 |  193 | beef/ buffalo meat                                | She buffalo                         |
| 51 |  194 | pork                                              | Pig                                 |
| 52 |  195 | chicken                                           | Poultry birds                       |
| 53 |  200 | potato (includes sweet potato and green plantain) | Potato                              |
| 54 |  201 | onion                                             | Onion                               |
| 55 |  202 | tomato                                            | Tomato                              |
| 56 |  203 | brinjal                                           | Brinjal                             |
| 57 |  206 | palak/other leafy vegetables                      | Leafy vegetables                    |
| 58 |  207 | chillis: green                                    | Chillies                            |
| 59 |  212 | cabbage                                           | Cabbage                             |
| 60 |  216 | lemon                                             | Lemon                               |
| 61 |  217 | other vegetables (rural)                          | Other vegetables                    |
| 62 |  217 | other vegetables (urban)                          | Other vegetables                    |
| 63 |  220 | banana                                            | Banana                              |
| 64 |  224 | coconut                                           | Coconut                             |
| 65 |  228 | orange, mausami                                   | Orange                              |
| 66 |  231 | mango                                             | Mango                               |
| 67 |  237 | grapes                                            | Grapes                              |
| 68 |  238 | other fresh fruits (rural)                        | Other Fruits                        |
| 69 |  238 | other fresh fruits (urban)                        | Other Fruits                        |
| 70 |  241 | groundnut                                         | Groundnuts                          |
| 71 |  260 | oilseeds                                          | Sesamum                             |
| 72 |  260 | oilseeds                                          | Other oilseeds                      |
| 73 |  261 | other spices                                      | Fennel                              |
| 74 |  261 | other spices                                      | Other spices                        |
| 75 |  271 | tea : cups                                        | Tea                                 |
| 76 |  272 | coffee : cups                                     | Coffee                              |
| 77 |  280 | cooked meals purchased                            | Meals                               |
| 78 |  280 | cooked meals purchased                            | Complete meals in hotel             |
| 79 |  296 | other packaged processed food (rural)             | Various processed foods             |
| 80 |  296 | other packaged processed food (urban)             | Various processed foods             |
| 81 |  301 | pan: finished                                     | Pan, betel, etc.                    |



** Calculate ICRISAT Nutrients & Standardized Quantities
#+begin_src ipython :tangle nutrients.py
import pandas as pd
import numpy as np

def prices(Q,X,tol=1e-6):
    """Impute prices from data on expenditures and quantities.

    Non-trivial because quantities may be reported in different units.
    """
    
    myQ = Q.groupby(['j','t','m','unit']).sum()

    B={}
    for t in myQ.index.levels[1]:
        for m in myQ.index.levels[2]:
            for i in myQ.columns:
                useX = X.query("t==%d and m=='%s'" % (t,m))[i].fillna(0)
                useQ = myQ.query("t==%d and m=='%s'" % (t,m))[i].fillna(0).unstack('unit')
                if len(useX):
                    q,x = useQ.fillna(0).align(useX.fillna(0),axis=0,join='inner')
                    b = np.linalg.lstsq(q,x,rcond=None)[0]
                    b = pd.Series(b,index=q.columns,name=i)
                    B[(t,m,i)] = b.where(b>0,0).round(6)

    P = pd.concat(B).replace(0,np.nan).dropna()
    P.index.names = ['t','m','i','unit']

    P = P.unstack(['i','unit'])
    
    return P


def quantities(X,P,tol=1e-6):
    """
    Return standardized quantities from expenditures & prices.

    Inputs are:
        - X :: DataFrame of expenditures, with index (j,t,m)
        - P :: DataFrame of prices, with index (i,unit,m,t)
               and columns (i,m,t).
    """

    Q={}
    for t in X.index.levels[1]:
        for m in X.index.levels[2]:
            useX = X.query("t==%d and m=='%s'" % (t,m)).fillna(0)
            try:
                useP = P.xs((t,m)).fillna(0).unstack('unit')
                foo = useX.align(useP.T,axis=1,join='inner')
                if len(useX):
                    myQ = foo[0]@pd.DataFrame(np.linalg.pinv(foo[1]),index=foo[1].columns,columns=foo[1].index)
                    myQ = myQ.loc[:,(myQ > tol).sum()>1]
                    Q[(t,m)] = myQ
            except KeyError: pass

    return Q

def nutrition(fct,Q,tol=1e-6):
    """Compute household nutritional intake.

    Inputs:

     - fct :: food conversion DataFrame with index of food
              labels and units, and columns nutrients.

     - Q :: Dictionary of DataFrames with keys (t,m'); each DataFrame
            is Food quantities, index of j, columns (i, units).
    """

    N = {}
    for k in Q.keys():
        baz = Q[k].align(fct.T,axis=1,join='inner')

        myN = baz[0].fillna(0)@baz[1].fillna(0).T
        N[k] = myN.loc[myN.sum(axis=1)>tol,:]

    return N

Q = pd.read_pickle('q.df')
X = pd.read_pickle('x.df')

X.columns.name = 'i'
Q.columns.name = 'i'
    
fct = pd.read_pickle('fct_units.df')
fct.index.names = ['i','unit']

P = prices(Q,X,tol=1e-6)

# Get prices using units in fct:
myP = P.T.align(fct,axis=0,join='right')[0].T

myP0 = myP.copy()
myP0.columns = myP0.columns.droplevel('unit')

myP0 = myP0.dropna(how='all')
myP0.to_pickle('prices.df')

#Qhat = quantities(X,P)

# Nutrients per day
#N = {k:n/365 for k,n in nutrition(fct,Qhat).items()}

#N = pd.concat(N.values())

#N.to_pickle('nutrients.df')

#N.head()
#+end_src


* Demographics from Schedule C
#+begin_src ipython :tangle c.py
import numpy as np
import pandas as pd
from collections import OrderedDict

r0 = pd.read_csv('~/Data/VLS/MyVLS/VLS1/Chicago/sc.raw',delimiter="\s+",
                 header=None,skiprows=filter(lambda x: x % 6 != 0,range(81924)),
                 names=['village','class','hhno','year','dayofint','member','rltohd'])

r1 = pd.read_csv('~/Data/VLS/MyVLS/VLS1/Chicago/sc.raw',delimiter="\s+",
                 header=None,skiprows=filter(lambda x: x % 6 != 1,range(81924)),
                 names=['sex','age','marst','educ','yrended','mocc','socc'])

C = pd.concat([r0,r1],axis=1)

# Create unique household ID
C.village.replace(to_replace={1:'A',2:'B',3:'C',4:'D',5:'E',6:'F'},inplace=True)
C.sex.replace(to_replace={6:'F',13:'M'},inplace=True)

C['HHID'] = ['%s%d' % l for l in zip(C.village,C.hhno.fillna(0))]
del C['hhno']

#| Nutrition                      | Source | C 1-3 | F 4-8 | M 4-8 | F 9-13 | M 9-13 | F 14-18 | M 14-18 | F 19-30 | M 19-30 | F 31-50 | M 31-50 | F 51+ | M 51+ |

agesex = ['C 0-0.5', 'C 0.5-1', 'C 1-3', 'C 4-6', 'C 7-9',
          'B 10-12', 'B 13-15', 'B 16-17',
          'G 10-12', 'G 13-15', 'G 16-17',
          'M','W']

C['C 0-0.5'] = C['age'] <= 0.5
C['C 0.5-1'] = (C['age'] > 0.5) & (C['age'] <= 1)
C['C 1-3'] = (C['age'] > 1) & (C['age'] <= 3)
C['C 4-6'] = (C['age'] > 3) & (C['age'] <= 6)
C['C 7-9'] = (C['age'] > 6) & (C['age'] <= 9)

C['B 10-12'] = (C['sex']=='M') & (C['age'] > 9) & (C['age'] <= 12)
C['G 10-12'] = (C['sex']=='F') & (C['age'] > 9) & (C['age'] <= 12)

C['B 13-15'] = (C['sex']=='M') & (C['age'] > 12) & (C['age'] <= 15)
C['G 13-15'] = (C['sex']=='F') & (C['age'] > 12) & (C['age'] <= 15)

C['B 16-17'] = (C['sex']=='M') & (C['age'] > 15) & (C['age'] <= 17)
C['G 16-17'] = (C['sex']=='F') & (C['age'] > 15) & (C['age'] <= 17)

C['M'] = (C['sex']=='M') & (C['age'] > 17) 
C['W'] = (C['sex']=='F') & (C['age'] > 17) 

C.to_pickle('c.df')

z = C.groupby(['village','year','HHID'])[agesex].sum() #['Men','Women','Boys','Girls']].sum()
z['log Hsize'] = np.log(z.sum(axis=1))

z.index.names = ['m','t','j']
z = z.reorder_levels(['j','t','m'])

z.to_pickle('z.df')

#+end_src




* Nutritional needs of households

| Sex-Age | Calories | Protein | Fat | Calcium | Iron | Betacarotene | Thiamine | Riboflavin | Niacin | Ascorbic Acid |
|---------+----------+---------+-----+---------+------+--------------+----------+------------+--------+---------------|
| C 0-0.5 |          |         |     |     500 |      |              |       .2 |         .3 |        |            25 |
| C 0.5-1 |          |         |  19 |     500 |    5 |         2800 |       .3 |         .4 |        |            25 |
| C 1-3   |     1060 |    16.7 |  27 |     600 |    9 |         3200 |       .5 |         .6 |      8 |            40 |
| C 4-6   |     1350 |    20.1 |  25 |     600 |   13 |         3200 |       .7 |         .8 |     11 |            40 |
| C 7-9   |     1690 |    29.5 |  30 |     600 |   16 |         4800 |       .8 |         1. |     13 |            40 |
| B 10-12 |     2190 |    39.9 |  35 |     800 |   21 |         4800 |      1.1 |        1.3 |     15 |            40 |
| G 10-12 |     2010 |    40.4 |  35 |     800 |   27 |         4800 |       1. |        1.2 |     13 |            40 |
| B 13-15 |     2750 |    54.3 |  45 |     800 |   32 |         4800 |      1.4 |        1.6 |     16 |            40 |
| G 13-15 |     2330 |    51.9 |  40 |     800 |   27 |         4800 |      1.2 |        1.4 |     14 |            40 |
| B 16-17 |     3020 |    61.5 |  50 |     800 |   28 |         4800 |      1.5 |        1.8 |     17 |            40 |
| G 16-17 |     2440 |    55.5 |  35 |     800 |   26 |         4800 |       1. |        1.2 |     14 |            40 |
| M       |     2730 |      60 |  30 |     600 |   17 |         4800 |      1.4 |        1.4 |     18 |            40 |
| W       |     2230 |      55 |  25 |    1200 |   21 |         4800 |      1.1 |        1.3 |     14 |            40 |



* Write DataFrames to google sheet
#+begin_src python :results output :var user="ethan.ligon@gmail.com" spread_fn="ICRISAT expenditures"
import pandas as pd
import numpy as np
from gspread_pandas import Client, Spread
from gspread_pandas.client import SpreadsheetNotFound

client = Client(user)

try:
    spread = Spread(user,spread_fn)
except SpreadsheetNotFound:
    client.create(spread_fn)
    spread = Spread(user,spread_fn)
    spread.delete_sheet('Sheet1')

y = pd.read_pickle('y.df')
q = pd.read_pickle('q.df')
z = pd.read_pickle('z.df')
#z.index.names = ['m','t','j']
#z = z.reorder_levels(['j','t','m'])

spread.df_to_sheet(np.exp(y),sheet="Expenditures")
spread.df_to_sheet(z,sheet="Household Characteristics")
spread.df_to_sheet(q,sheet="Consumption")
spread.df_to_sheet(pd.read_pickle('fct.df'),sheet="FCT")

print(spread.sheets)

#+end_src

#+results:
[<Worksheet 'Expenditures' id:744482690>, <Worksheet 'Household Characteristics' id:1760828959>, <Worksheet 'Consumption' id:1987214981>, <Worksheet 'FCT' id:936160040>]
[<Worksheet 'Expenditures' id:744482690>, <Worksheet 'Household Characteristics' id:1760828959>, <Worksheet 'Consumption' id:1987214981>, <Worksheet 'FCT' id:936160040>]
[<Worksheet 'Expenditures' id:744482690>, <Worksheet 'Household Characteristics' id:1760828959>, <Worksheet 'Consumption' id:1987214981>, <Worksheet 'FCT' id:936160040>]
[<Worksheet 'Expenditures' id:744482690>, <Worksheet 'Household Characteristics' id:1760828959>, <Worksheet 'Consumption (kgs)' id:973503312>, <Worksheet 'Consumption' id:1987214981>]
[<Worksheet 'Expenditures' id:744482690>, <Worksheet 'Household Characteristics' id:1760828959>, <Worksheet 'Consumption (kgs)' id:973503312>]
[<Worksheet 'Expenditures' id:744482690>, <Worksheet 'Household Characteristics' id:1760828959>]

* Estimating Demands
#+begin_src ipython :tangle estimation.py
import pandas as pd
import cfe
import numpy as np

z = pd.read_pickle('z.df')

y = pd.read_pickle('y.df')

prices = pd.read_pickle('prices.df')

#y = np.log(pd.read_pickle('q.df').replace(0,np.nan))

y = y.to_xarray().to_array('i')
z = z.to_xarray().to_array('k')
prices = prices.to_xarray().to_array('i')

result = cfe.Result(y=y,z=z,prices=prices)

result.get_predicted_log_expenditures()
result.get_loglambdas()
result.get_alpha()

result.to_dataset('result.ds')

print(cfe.df_utils.df_to_orgtbl(result.beta.to_dataframe().sort_values('beta',ascending=False)))
#+end_src

#+results:
| i                                                       | beta      |
|---------------------------------------------------------+-----------|
| Ceremonial expenses                                     | \(1.314\) |
| Milk                                                    | \(0.925\) |
| Redgram dhal                                            | \(0.856\) |
| Soap, washing powder                                    | \(0.854\) |
| Sugar                                                   | \(0.836\) |
| Travel & Entertainment                                  | \(0.789\) |
| Pan, betel, etc.                                        | \(0.676\) |
| Educational material expenses (pen, books, paper, etc.) | \(0.658\) |
| Bengalgram dhal                                         | \(0.636\) |
| Gur (jaggery)                                           | \(0.613\) |
| Clothing                                                | \(0.608\) |
| Cosmetics tooth paste etc.                              | \(0.601\) |
| Medicine Doctor's fees                                  | \(0.593\) |
| Tea                                                     | \(0.571\) |
| Other vegetables                                        | \(0.506\) |
| Coconut                                                 | \(0.445\) |
| Other spices                                            | \(0.433\) |
| Utilities                                               | \(0.381\) |
| Onion                                                   | \(0.367\) |
| Grinding/milling charges                                | \(0.355\) |
| Complete meals in hotel                                 | \(0.350\) |
| Tobacco, beedi                                          | \(0.278\) |
| Jowar/Sorghum (Local variety)                           | \(0.242\) |
| Chillies                                                | \(0.135\) |
:end:


* Expenditures and Nutrients vs. \log\lambda

** Expenditures vs. \log\lambda
   :PROPERTIES:
   :EXPORT_FILE_NAME: exp_vs_loglambda.ipynb
   :END:
#+begin_src ipython
%matplotlib inline
import cfe
import pandas as pd
import matplotlib.pyplot as plt

r0 = cfe.from_dataset('result.ds')

# Turn off variation in household composition
r0['z'] = r0['z']*0

l0 = r0.loglambdas.sel(t=75,m='A')

# Predicted total expenditures given lambda & prices
x0 = r0.get_predicted_expenditures().sum('i').sel(t=75,m='A')

plt.scatter(x0,l0)
plt.show()
#+end_src

** Nutrients
Now consider nutrients:
#+begin_src ipython

Q = r0.get_predicted_expenditures().sel(t=75,m='A',drop=True).to_dataframe('q')
Q = Q.unstack('i')
Q.columns = Q.columns.droplevel(0)

fct = pd.read_pickle('fct.df')

# Intersection of foods in Q and fct0
use = list(set(fct.index.tolist()).intersection(Q.columns))

# Inner product of quantities of food and FCT gives nutrients
N = Q[use].dot(fct.loc[use,:])

# Nutrients per day
N = N.groupby(['j']).sum()/365

pl.scatter(l0,N['pu_prot'])
pl.scatter(l0,N['pu_cal'])
pl.scatter(l0,x0)
pl.legend(['Protein','Calories','Tot. Exp'])
pl.show()

#+end_src


#+begin_src ipython

fct = pd.read_pickle('fct.df')

fct.head()
#+end_src

#+results:
:results:
# Out[6]:
# text/plain
:                           protein   fat       fibre  carbohydrate  \
: ICRISAT Food Label                                                  
: Paddy (Local variety)   78.099998   5.5   37.400002    771.600037   
: Paddy (HYV)             78.099998   5.5   37.400002    771.600037   
: Rice (local variety)    78.099998   5.5   37.400002    771.600037   
: Rice (HYV variety)      78.099998   5.5   37.400002    771.600037   
: Wheat (Local variety)  105.800003  15.0  112.949997    644.449951   
: 
:                        energy_kcal  energy_kj     calcium       iron  \
: ICRISAT Food Label                                                     
: Paddy (Local variety)  3513.423096    14710.0   81.099998   7.200000   
: Paddy (HYV)            3513.423096    14710.0   81.099998   7.200000   
: Rice (local variety)   3513.423096    14710.0   81.099998   7.200000   
: Rice (HYV variety)     3513.423096    14710.0   81.099998   7.200000   
: Wheat (Local variety)  3208.894531    13435.0  351.500000  40.349998   
: 
:                        betacarotene  caroten_total  thiamine  riboflavin  \
: ICRISAT Food Label                                                         
: Paddy (Local variety)           0.0          469.0       1.7         0.6   
: Paddy (HYV)                     0.0          469.0       1.7         0.6   
: Rice (local variety)            0.0          469.0       1.7         0.6   
: Rice (HYV variety)              0.0          469.0       1.7         0.6   
: Wheat (Local variety)          28.5         2840.0       4.4         1.5   
: 
:                        niacin  ascorbic_total  ext_source  pu_cal  pu_prot  \
: ICRISAT Food Label                                                           
: Paddy (Local variety)   25.10             0.0         0.0  3460.0     75.0   
: Paddy (HYV)             25.10             0.0         0.0  3460.0     75.0   
: Rice (local variety)    25.10             0.0         0.0  3460.0     75.0   
: Rice (HYV variety)      25.10             0.0         0.0  3460.0     75.0   
: Wheat (Local variety)   25.25             0.0         0.0  3410.0    121.0   
: 
:                        pu_fat  
: ICRISAT Food Label             
: Paddy (Local variety)     5.0  
: Paddy (HYV)               5.0  
: Rice (local variety)      5.0  
: Rice (HYV variety)        5.0  
: Wheat (Local variety)    17.0  

# text/html
#+BEGIN_EXPORT html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>protein</th>
      <th>fat</th>
      <th>fibre</th>
      <th>carbohydrate</th>
      <th>energy_kcal</th>
      <th>energy_kj</th>
      <th>calcium</th>
      <th>iron</th>
      <th>betacarotene</th>
      <th>caroten_total</th>
      <th>thiamine</th>
      <th>riboflavin</th>
      <th>niacin</th>
      <th>ascorbic_total</th>
      <th>ext_source</th>
      <th>pu_cal</th>
      <th>pu_prot</th>
      <th>pu_fat</th>
    </tr>
    <tr>
      <th>ICRISAT Food Label</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Paddy (Local variety)</th>
      <td>78.099998</td>
      <td>5.5</td>
      <td>37.400002</td>
      <td>771.600037</td>
      <td>3513.423096</td>
      <td>14710.0</td>
      <td>81.099998</td>
      <td>7.200000</td>
      <td>0.0</td>
      <td>469.0</td>
      <td>1.7</td>
      <td>0.6</td>
      <td>25.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3460.0</td>
      <td>75.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Paddy (HYV)</th>
      <td>78.099998</td>
      <td>5.5</td>
      <td>37.400002</td>
      <td>771.600037</td>
      <td>3513.423096</td>
      <td>14710.0</td>
      <td>81.099998</td>
      <td>7.200000</td>
      <td>0.0</td>
      <td>469.0</td>
      <td>1.7</td>
      <td>0.6</td>
      <td>25.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3460.0</td>
      <td>75.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Rice (local variety)</th>
      <td>78.099998</td>
      <td>5.5</td>
      <td>37.400002</td>
      <td>771.600037</td>
      <td>3513.423096</td>
      <td>14710.0</td>
      <td>81.099998</td>
      <td>7.200000</td>
      <td>0.0</td>
      <td>469.0</td>
      <td>1.7</td>
      <td>0.6</td>
      <td>25.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3460.0</td>
      <td>75.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Rice (HYV variety)</th>
      <td>78.099998</td>
      <td>5.5</td>
      <td>37.400002</td>
      <td>771.600037</td>
      <td>3513.423096</td>
      <td>14710.0</td>
      <td>81.099998</td>
      <td>7.200000</td>
      <td>0.0</td>
      <td>469.0</td>
      <td>1.7</td>
      <td>0.6</td>
      <td>25.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3460.0</td>
      <td>75.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Wheat (Local variety)</th>
      <td>105.800003</td>
      <td>15.0</td>
      <td>112.949997</td>
      <td>644.449951</td>
      <td>3208.894531</td>
      <td>13435.0</td>
      <td>351.500000</td>
      <td>40.349998</td>
      <td>28.5</td>
      <td>2840.0</td>
      <td>4.4</td>
      <td>1.5</td>
      <td>25.25</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3410.0</td>
      <td>121.0</td>
      <td>17.0</td>
    </tr>
  </tbody>
</table>
</div>
#+END_EXPORT
:end:






